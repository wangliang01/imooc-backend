(()=>{"use strict";var e={193:(e,r,o)=>{o.d(r,{A:()=>p});const t=require("koa-combine-routers");var n=o.n(t);const s=require("koa-router");var a=o.n(s);const i=require("require-directory");var c=o.n(i),u=o(928),d=o.n(u);e=o.hmd(e);const l=[];c()(e,d().join(__dirname,"../router"),{visit:e=>{const r=e.default;r instanceof a()&&l.push(r)}});const p=n()(...l)},928:e=>{e.exports=require("path")}},r={};function o(t){var n=r[t];if(void 0!==n)return n.exports;var s=r[t]={id:t,loaded:!1,exports:{}};return e[t](s,s.exports,o),s.loaded=!0,s.exports}o.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return o.d(r,{a:r}),r},o.d=(e,r)=>{for(var t in r)o.o(r,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},o.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),o.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);const t=require("dotenv");var n=o.n(t),s=o(928),a=o.n(s);n().config({path:a().join(__dirname,"../../.env")});try{n().config({path:a().join(__dirname,"../../.env.prod")})}catch(e){console.log("没有找到 .env.prod 文件")}const i=require("koa");var c=o.n(i);const u=require("koa-body"),d=require("@koa/cors");var l=o.n(d);const p=require("koa-json");var v=o.n(p);const m=require("koa-helmet");var h=o.n(m);const _=require("koa-static");var y=o.n(_),g=o(193);const q=require("koa-compose");var k=o.n(q);const E=require("koa-compress");var O=o.n(E);const S=require("koa-session");var b=o.n(S);Error;const f=async(e,r)=>{try{await r()}catch(r){if(401===r.status)return e.status=401,void(e.body={msg:"用户未授权，请在访问时在header中加入Authorization",code:401,data:null});e.status=500,e.body={msg:"服务器异常，请稍后重试",code:999,data:null}}},x=require("koa-jwt");var j=o.n(x);const A=new(c());console.log("NODE_ENV",process.env),A.use(f),A.keys=[process.env.KOA_SESSION_KEYS];const w={key:process.env.KOA_SESSION_KEY,maxAge:+process.env.KOA_SESSION_MAX_AGE,autoCommit:!0,overwrite:!0,httpOnly:!0,signed:!0,rolling:!1,renew:!1},K=k()([(0,u.koaBody)({multipart:!0}),l()(),v()(),j()({secret:process.env.JWT_SECRET}).unless({path:[/^\/api\/login/,/^\/api\/register/,/^\/api\/public/]}),b()(w,A),h()(),y()(a().join(__dirname,"../public")),(0,g.A)()]);A.use(K),A.use(O()());let N=process.env.PORT||3e3;console.log("port",N),A.listen(N,(()=>{console.log("server is running at http://localhost:3000")}))})();